<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Traffic Fatalities in North Carolina, 2012</title>
		<script src="../d3.js" charset="utf-8"></script>
		<style media="screen">
			body {
				background-color: lightGrey;
				font-family: Helvatica, sans-serif;
			}

			svg	{
				background-color: white;
				box-shadow: 3px 3px 5px #ccc;
			}

			g.bar text {
				font-size: 11px;
				font-family: sans-serif;
				font-weight: bold;
				text-anchor: middle;
			}
		</style>
	</head>
	<body>
		<h2>Traffic Fatalities in North Carolina, 2012</h2>
	</body>
	<script type="text/javascript">
		var dataset = [{month: 'January', fatalities: 73}, {month: 'February', fatalities: 86}, {month: 'March', fatalities: 97},
		 	{month: 'April', fatalities: 85}, {month: 'May', fatalities: 109}, {month: 'June', fatalities: 118},
		 	{month: 'July', fatalities: 125}, {month: 'August', fatalities: 120}, {month: 'September', fatalities: 128},
			{month: 'October', fatalities: 116},{month: 'November', fatalities: 110}, {month: 'December', fatalities: 95}];

		var w = 500;
		var h = 600;
		var padding = [ 50, 20, 30, 50];


		var xScale = d3.scale.ordinal()
			// .domain(d3.range(dataset.length))
			.domain(dataset.map(function(d){ return d.month; }))
			.rangeRoundBands([padding[3], w - padding[1] ], 0.1);

		var yScale = d3.scale.linear()
			.domain([d3.max(dataset, function(d){ return d.fatalities; }), 0])
			.range([0, h - padding[0] - padding[2]]);


		var xAxis = d3.svg.axis()
			.scale(xScale)
			.orient('bottom');

		var yAxis = d3.svg.axis()
			.scale(yScale)
			.orient('left');

		var svg = d3.select('body')
			.append('svg')
			.attr({
				width: w,
				height: h
			});

		var groups = svg.selectAll("g")
			.data(dataset)
			.enter()
			.append("g")
			.attr("class", "bar");


		var bars = groups.append('rect')
			.attr({
				x: function(d){ return xScale(d.month); },
				y:  h - padding[2],
				width: xScale.rangeBand(),
				height: 0,
				fill: 'steelblue'
		 	});

		var text = groups.append('text')
			.text(function(d){ return d.fatalities; })
			.attr({
				x: function(d){ return xScale(d.month) + xScale.rangeBand()/2; },
				y: h - padding[2],
			});

		bars.transition()
			.duration(500)
			.attr({
				y: function(d){ return h -  padding[2] - yScale(d.fatalities); },
				height: function(d){ return yScale(d.fatalities); }
			});

		text.transition()
			.duration(500)
			.attr({
				x: function(d){ return xScale(d.month) + xScale.rangeBand()/2; },
				y: function(d){ return h - padding[2] - yScale(d.fatalities) + 15; },
			});

		svg.append('g')
			.attr({
				class: 'x axis',
				transform: 'translate( ' + padding[3] + ', ' + (h - padding[2]) + ')',
			})
			.call(xAxis);

		svg.append('g')
			.attr({
				class: 'y axis',
				transform: 'translate( ' + padding[0] + ', ' + padding[3] + ')',
			})
			.call(yAxis);

	</script>
</html>
